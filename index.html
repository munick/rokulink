<html><head>
<style>
.heading { 
    margin: auto;
}
h1 {
    color: #333;
    font-weight: 500;
    line-height: 1.1;
    font-family: GothamLight,GothamBook,Helvetica,Arial,sans-serif;
    margin-top: 22px;
    margin-bottom: 11px;
}
</style>
</head>
<body>
<div class='heading'><h1>RokuLink</h1></div>
    
<script>
(function() {
  var postform = document.createElement("form");
  postform.style.display="none";
  postform.id="postform";
  postform.method="post";
  postform = document.body.appendChild(postform);
	
  var keyMap = new Map([
    ['H', 'Home'],
    //['R', 'Rev'],
    ['F', 'Fwd'],
    ['P', 'Play'],
    ['S', 'Select'],
    ['L', 'Left'],
    ['R', 'Right'],
    ['D', 'Down'],
    ['U', 'Up'],
    ['B', 'Back'],
    ['I', 'InstantReplay'],
    //['I', 'Info'],
    //['B', 'Backspace'],
    //['S', 'Search'],
    ['E', 'Enter']
  ]);
    
  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
  
  async function postRequest(url) {
    var postform = document.getElementById("postform");
    postform.setAttribute("action", url);
	postform.submit();
    await sleep(750);
  }
  
  function getIP() {
    var url = new URL(window.location.href);
    return url.searchParams.get("ip");    
  }
  
  function getApp() {
    var url = new URL(window.location.href);
    return url.searchParams.get("app");    
  }
  
  function launchApp(ip, appId) {      
    var request_url = ip + '/launch/' + appId;
    postRequest(request_url);
  }
  
  function getKeys() {
    var url = new URL(window.location.href);
    return url.searchParams.get("keys");    
  }
  
  function keyPress(ip, key) {
    request_url = ip + '/keypress/' + key;
    postRequest(request_url);
  }
  
  function keySequence(ip, sequence) {
    sequence.forEach(key => {keyPress(ip, key)});
  }
    
  launchApp(getIP(), getApp());
  var keys = getKeys().split('').map(k => keyMap.get(k));
  keySequence(getIP(), keys);
  
})();
</script>
</body>
</html>
